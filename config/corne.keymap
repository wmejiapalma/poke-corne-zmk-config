/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <dt-bindings/zmk/mouse.h>
#include <behaviors.dtsi>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/keys.h>



#define U_MOUSE_MOVE_MAX 1200                     /* <--- New max speed setting (default: 600) */
#undef MOVE_UP
#undef MOVE_DOWN
#undef MOVE_LEFT
#undef MOVE_RIGHT
#define MOVE_UP MOVE_VERT(-U_MOUSE_MOVE_MAX)
#define MOVE_DOWN MOVE_VERT(U_MOUSE_MOVE_MAX)
#define MOVE_LEFT MOVE_HOR(-U_MOUSE_MOVE_MAX)
#define MOVE_RIGHT MOVE_HOR(U_MOUSE_MOVE_MAX)    
&mmv {
    time-to-max-speed-ms = <400>;             /* <--- How long time until max speed is reached (default: 500) */
};

#define U_MOUSE_SCROLL_MAX 50                    /* <--- New max speed setting (default: 10) */

#undef SCROLL_UP
#undef SCROLL_DOWN
#undef SCROLL_LEFT
#undef SCROLL_RIGHT
#define SCROLL_UP SCROLL_VERT(U_MOUSE_SCROLL_MAX)
#define SCROLL_DOWN SCROLL_VERT(-U_MOUSE_SCROLL_MAX)
#define SCROLL_LEFT SCROLL_HOR(-U_MOUSE_SCROLL_MAX)
#define SCROLL_RIGHT SCROLL_HOR(U_MOUSE_SCROLL_MAX)
//LEFT, DOWN, RIGHT mouse keys in one macro so that the layout can be better organized

&mwh {
  time-to-max-speed-ms = <500>;                 /* <--- How long time until max speed is reached */
};

/ {
    
    //TODO: maybe replace the LCTRL with backspace for tap and hold for something else ()

    behaviors {
        escdelete: escdelete {
            compatible = "zmk,behavior-tap-dance";
            label = "ESCDELETE";
            #binding-cells = <0>;
            bindings = <&kp ESC>, <&kp DELETE>;
        };
    };

    combos {
        compatible = "zmk,combos";
        combo_esc {
            timeout-ms = <50>;
            key-positions = <37 40>;
            bindings = <&mo 3>;
        };
    };
    
    keymap {
        compatible = "zmk,keymap";

        default_layer {
            label = "Base";
            bindings = <
                // __________________________________________________________________________________________________________
                // |  TAB  |   Q   |   W   |   F   |   P   |   B   |        |   J   |   L   |   U   |   Y   |   ;    | BKSP |
                  &kp TAB  &kp Q   &kp W   &kp F   &kp P   &kp B            &kp J   &kp L   &kp U   &kp Y   &kp SEMI &kp BSPC
                // __________________________________________________________________________________________________________
                // |  BKSP |   A   |   R   |   S   |   T   |   G   |        |   M   |   N   |   E   |   I   |   O    | ENT  |
           &lt 4 BACKSPACE &kp A   &kp R   &kp S   &kp T   &kp G            &kp M   &kp N   &kp E   &kp I   &kp O    &kp ENTER
                // _________________________________-------__________________________-------_________________________________
                // |  SHFT |   Z   |   X   |   C   |   D   |   V   |        |   K   |   H   |   ,   |   .   |   /    | ESC  |
                 &kp LSHFT &kp Z   &kp X   &kp C   &kp D   &kp V            &kp K   &kp H  &kp COMMA  &kp DOT &kp FSLH &escdelete
                // 
                // __________________________________________________________________________________________________________
                //                   |   GUI   |    LWR    |    CTRL    |        |   SPC   |    RSE    |   ALT    |
                                      &kp LGUI   &mo 1     &kp LCTRL             &kp SPACE &lt 2 ENTER  &kp RALT 



            >;
        };

        lower_layer {
            label = "Lower";
            bindings = <
                // __________________________________________________________________________________________________________
                // |  ESC  |   !   |   @   |   #   |   $   |   %   |        | PG_UP   |       |   UP   |   (   |    )   | DEL |
                    &kp ESC  &kp EXCL &kp AT &kp HASH &kp DLLR &kp PRCNT      &kp PG_UP &trans &kp UP &kp LPAR &kp RPAR  &kp DELETE
                // _________________________________________________________________________________________________________
                // |  CTRL |  F1   |  F2   |  F3   |  F4   |   F5  |        | PG_DN |  LFT  |  DWN   |  RGT  |  \   |   '  |
                &kp LCTRL &kp F1  &kp F2  &kp F3  &kp F4   &kp F5       &kp PG_DN &kp LEFT &kp DOWN &kp RIGHT &kp BSLH &kp SINGLE_QUOTE
                // _________________________________-------__________________________-------_________________________________
                // |  SHFT |  F6   |  F7   |  F8   |  F9   |  F10  |        |       |       |       |       |        | ESC  |
                &kp LSHFT &kp F6  &kp F7  &kp F8  &kp F9  &kp F10           &trans  &trans  &trans &trans &trans &kp ESC
                // __________________________________________________________________________________________________________
                //                   |   GUI   |         |         |        |   SPC     |   F11    |   F12    |
                                    &kp LGUI      &trans     &trans         &kp SPACE   &kp F11    &kp F12 
            >;
        };
        raise_layer {
            label = "Raise";
            bindings = <
                // __________________________________________________________________________________________________________
                // |       |   1   |   2   |   3   |   4   |   5   |        |   6   |   7   |   8   |   9   |   0    |      |
                    &trans  &kp N1  &kp N2  &kp N3  &kp N4   &kp N5           &kp N6 &kp N7  &kp N8  &kp N9  &kp N0  &trans
                // _________________________________________________________________________________________________________
                // |  CTRL |       |       |       |   -   |   `   |        |   =   |   {   |   }   |       |   \    | ENT  |
                 &kp LCTRL  &trans &trans &trans &kp MINUS &kp GRAVE     &kp EQUAL   &kp LBRC &kp RBRC &trans &trans &kp ENTER
                // _________________________________-------__________________________-------_________________________________
                // |  SHFT |       |       |       |   _   |       |        |       |   [   |   ]   |       |        | ESC  |
                 &kp LSHFT  &trans  &trans &trans &kp UNDER  &trans          &trans  &kp LBKT &kp RBKT &trans &trans &kp ESC
                //
                // __________________________________________________________________________________________________________
                //                   |         |         |         |        |          |         |   ALT    |
                                      &trans   &trans     &trans             &trans      &trans     &kp RALT 
            >;
        };
        extra_layer {
            label = "Extra";
            bindings = <
                // __________________________________________________________________________________________________________
                // | BT_CLR|       |       |       |BT_PRV | BT_NXT|        |       |       |       |       |        |      |
                &bt BT_CLR  &trans  &trans  &trans &bt BT_PRV &bt BT_NXT     &trans  &trans  &trans  &trans  &trans   &trans
                // __________________________________________________________________________________________________________
                // |       |       |       |VOL_DWN|VOL_UP |       |        |       | PSCRN |       |       |        | ENT  |
                &trans &trans &trans   &kp C_VOL_DN &kp C_VOL_UP &trans       &trans &kp PSCRN  &trans  &trans  &trans  &kp ENTER
                // _________________________________-------__________________________-------_________________________________
                // |       |       |       |       |       |       |        |       |       |       |       |        |      |
                    &trans  &trans  &trans  &trans  &trans  &trans           &trans  &trans  &trans  &trans  &trans   &trans
                //
                // __________________________________________________________________________________________________________
                //                   |         |         |         |        |          |         |          |
                                      &trans     &trans     &trans           &trans      &trans     &trans 
            >;
        };
        mouse_layer {
            label = "Mouse";
            bindings = <
                // __________________________________________________________________________________________________________
                // |       |       |       |       |MDIA_PP| MUTE |        |   MW_UP  | M_RCLK  |  M_UP  |         |        | BKSP |
                    &trans  &trans  &trans  &trans &kp C_PP &kp C_MUTE     &mwh SCROLL_UP &mkp LCLK &mmv MOVE_UP &trans &trans   &kp BSPC
                // __________________________________________________________________________________________________________
                // |       |       |       |VOL_DWN|VOL_UP |       |        |   MW_DWN    |  M_LFT  |  M_DWN  |  M_RGT  |        | ENT  |
                   &trans  &trans &trans &kp C_VOL_DN &kp C_VOL_UP &trans      &mwh SCROLL_DOWN &mmv MOVE_LEFT &mmv MOVE_DOWN &mmv MOVE_RIGHT &trans  &kp ENTER
                // _________________________________-------__________________________-------_________________________________
                // |  SHFT |       |       |       | M_LCLK |       |       |         |  M_LCLK |        |         |         |      |
                    &kp LSHFT &trans  &trans  &trans &mkp LCLK  &trans         &trans  &mkp LCLK  &trans  &trans   &trans    &trans
                //
                // __________________________________________________________________________________________________________
                //                   |         |         |    CTRL   |        |          |         |          |
                                      &trans     &trans     &kp LCTRL           &trans      &trans     &trans 
            >;
        };
    };
};
